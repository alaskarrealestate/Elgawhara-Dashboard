<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>خريطة البلكات التفاعلية - مجموعة العسكر</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Open Graph - يظهر عند مشاركة الرابط -->
<meta property="og:title" content="خريطة البلكات التفاعلية - مجموعة العسكر">
<meta property="og:description" content="خريطة تفاعلية تعرض البلكات حسب القطاع ورقم البلك مع لوحة إحصائيات">
<meta property="og:image" content="thumbnail.png"> <!-- ضع هنا صورة مخطط الجوهرة -->
<meta property="og:url" content="https://yourdomain.com/index.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="خريطة البلكات التفاعلية - مجموعة العسكر">
<meta name="twitter:description" content="خريطة تفاعلية تعرض البلكات حسب القطاع ورقم البلك مع لوحة إحصائيات">
<meta name="twitter:image" content="thumbnail.png">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

<style>
body { margin:0; font-family:"Segoe UI", Tahoma, Arial; background:#f0f2f5; overflow-x:hidden; }
#container { display:flex; height:100vh; flex-direction:row-reverse; overflow:hidden; }
#map { flex:1; min-height:300px; }
#sidebar { width:360px; background:linear-gradient(180deg,#ffffff,#f7f9fb); padding:15px; box-shadow:-3px 0 18px rgba(0,0,0,0.25); display:flex; flex-direction:column; justify-content:flex-start; border-left:2px solid #e0e0e0; overflow-y:auto; }
#topLogo, #bottomLogo { width:100%; text-align:center; margin-bottom:10px; }
#topLogo img { width:150px; height:auto; }
#bottomLogo img { width:150px; height:auto; margin-top:30px; }
.title { font-weight:bold; margin-bottom:10px; color:#1c1f26; font-size:20px; text-align:center; }
.sectors { display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:12px; }
.sector-btn { flex:1; margin:4px; padding:10px; text-align:center; border-radius:8px; cursor:pointer; background:#e1e4e8; font-weight:bold; font-size:16px; color:#1c1f26; transition:0.3s; }
.sector-btn:hover { background:#cfd8dc; }
.sector-btn.active { background:#1565c0; color:#fff; }
select { width:100%; padding:10px; font-size:16px; border-radius:8px; border:1px solid #ccc; margin-bottom:12px; background:#f9f9f9; cursor:pointer; }
.stats { margin-top:12px; background:#f3f6f9; padding:12px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.stat { margin:8px 0; font-size:17px; }
.leaflet-tooltip.custom-tooltip { background:#263238; color:#fff; border-radius:6px; padding:8px; font-size:13px; }
@media (max-width:768px){ #container{flex-direction:column-reverse;} #sidebar{width:100%; max-height:30vh; box-shadow:0 -3px 12px rgba(0,0,0,0.2); border-left:none; border-top:2px solid #e0e0e0;} #map{flex:3; min-height:70vh;} .sectors{flex-direction:column;} .sector-btn{margin:3px 0;} }
</style>
</head>

<body>

<div id="container">

  <div id="sidebar">
    <!-- شعار مجموعة العسكر -->
    <div id="topLogo">
      <img src="logo_alsakar.png" alt="مجموعة العسكر">
    </div>

    <div class="title">القطاعات</div>
    <div class="sectors">
      <div class="sector-btn" data-sector="B">B</div>
      <div class="sector-btn" data-sector="G">G</div>
      <div class="sector-btn" data-sector="D">D</div>
    </div>

    <div class="title">رقم البلك</div>
    <select id="blockSelect">
      <option value="">اختر البلك</option>
    </select>

    <div class="stats">
      <div class="title">لوحة الإحصائيات</div>
      <div class="stat" id="stat1"></div>
      <div class="stat" id="stat2"></div>
      <div class="stat" id="stat3"></div>
      <div class="stat" id="stat4"></div>
      <div class="stat" id="stat5"></div>
    </div>

    <!-- شعار مخطط الجوهرة أسفل صفحة البحث -->
    <div id="bottomLogo">
      <img src="logo_jawhara.png" alt="مخطط الجوهرة">
    </div>
  </div>

  <div id="map"></div>

</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
const AR = { usage:{ residential:'سكني', commercial:'تجاري', undefined:'غير محدد' } };
function usageColor(u){ if(!u)return '#999999'; return u==='commercial'?'#c62828':'#1565c0'; }
function formatNumber(n){ return Number(n).toLocaleString('en-US',{ minimumFractionDigits:2, maximumFractionDigits:2 }); }

const map = L.map('map').setView([24.17556,47.27167],15);
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{ attribution:'© Esri' }).addTo(map);

let allMarkers = [], currentSector = null, selectedBlock = null;
const blockSelect = document.getElementById('blockSelect');

Papa.parse('plots.csv',{ download:true, header:true, complete:res=>{
  res.data.forEach(row=>{
    const lat=parseFloat(row.lat), lng=parseFloat(row.lng);
    if(!lat||!lng)return;
    const usageType=row.usage||'undefined';
    const color=usageColor(usageType);
    const marker=L.circleMarker([lat,lng],{ radius:7, color, weight:2, fillColor:color, fillOpacity:0.9 });
    marker.bindTooltip(`<b>القطاع:</b> ${row.sector}<br><b>رقم البلك:</b> ${row.block}<br><b>النوع:</b> ${AR.usage[usageType]}<br><b>المساحة:</b> ${formatNumber(row.area)} م²<br><b>عدد القطع:</b> ${row.plots_count}`,{ sticky:true, className:'custom-tooltip' });
    allMarkers.push({ marker, data:{...row, usage:usageType} });
  });
  refreshUI();
}});

function refreshUI(blockValue=null){
  let filtered=allMarkers.filter(o=>(currentSector&&o.data.sector===currentSector)&&(!blockValue||o.data.block===blockValue));
  allMarkers.forEach(o=>filtered.includes(o)?o.marker.addTo(map):map.removeLayer(o.marker));

  if(!blockValue && currentSector){
    blockSelect.innerHTML='<option value="">اختر البلك</option>';
    [...new Set(allMarkers.filter(o=>o.data.sector===currentSector).map(o=>o.data.block))].forEach(b=>{
      blockSelect.innerHTML+=`<option value="${b}">${b}</option>`;
    });
  }

  if(blockValue && filtered[0]){
    const d=filtered[0].data;
    stat1.innerHTML=`<b>القطاع:</b> ${d.sector}`;
    stat2.innerHTML=`<b>رقم البلك:</b> ${d.block}`;
    stat3.innerHTML=`<b>النوع:</b> ${AR.usage[d.usage]}`;
    stat4.innerHTML=`<b>المساحة:</b> ${formatNumber(d.area)} م²`;
    stat5.innerHTML=`<b>عدد القطع:</b> ${d.plots_count}`;
    map.setView([parseFloat(d.lat),parseFloat(d.lng)],18);
  }
  else if(currentSector){
    const sectorBlocks=allMarkers.filter(o=>o.data.sector===currentSector);
    const totalBlocks=sectorBlocks.length;
    const totalArea=sectorBlocks.reduce((sum,o)=>sum+parseFloat(o.data.area||0),0);
    stat1.innerHTML=`<b>عدد البلكات:</b> ${totalBlocks}`;
    stat2.innerHTML=`<b>إجمالي المساحة:</b> ${formatNumber(totalArea)} م²`;
    stat3.innerHTML=''; stat4.innerHTML=''; stat5.innerHTML='';
    map.setView([24.17556,47.27167],15);
  }else{
    stat1.innerHTML=`<b>عدد البلكات:</b> 0`;
    stat2.innerHTML=`<b>إجمالي المساحة:</b> 0 م²`;
    stat3.innerHTML=''; stat4.innerHTML=''; stat5.innerHTML='';
    map.setView([24.17556,47.27167],15);
  }
}

document.querySelectorAll('.sector-btn').forEach(btn=>{ btn.onclick=()=>{ document.querySelectorAll('.sector-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); currentSector=btn.dataset.sector; selectedBlock=null; refreshUI(); }; });
blockSelect.onchange=e=>{ selectedBlock=e.target.value||null; refreshUI(selectedBlock); };
</script>

</body>
</html>
